DROP SCHEMA IF EXISTS `BUG_TRACKER_DB`;

CREATE SCHEMA IF NOT EXISTS `BUG_TRACKER_DB`
CHARACTER SET `utf8`;

USE `BUG_TRACKER_DB`;
  
create table `USER_PROFILE` (
   `ID` BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
   `ROLE` VARCHAR(30) NOT NULL UNIQUE
);

create table `USER` (
   `ID` BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
   `LOGIN` VARCHAR(30) NOT NULL UNIQUE,
   `PASSWORD` VARCHAR(255) NOT NULL,
   `FIRST_NAME` VARCHAR(30) NOT NULL,
   `LAST_NAME`  VARCHAR(30) NOT NULL,
   `EMAIL` VARCHAR(30) NOT NULL,
   `FK_ROLE_ID` BIGINT NOT NULL,
   
   CONSTRAINT `FK_ROLE` FOREIGN KEY (`FK_ROLE_ID`) REFERENCES `USER_PROFILE` (`ID`)
);
 
CREATE TABLE `STATUS` (
	`ID` BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`TYPE` VARCHAR(30) NOT NULL UNIQUE
);

CREATE TABLE `PRIORITY` (
	`ID` BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`TYPE` VARCHAR(30) NOT NULL UNIQUE
);

CREATE TABLE `TYPE_PROJECT` (
	`ID` BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`TYPE` VARCHAR(30) NOT NULL UNIQUE
);

CREATE TABLE `PROJECT` (
	`ID` BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`NAME_PROJECT` VARCHAR(30) NOT NULL UNIQUE,
	`URL` VARCHAR(50) NOT NULL,
	`FK_MANAGER_ID` BIGINT NOT NULL,
	`FK_TYPE_PROJECT_ID` BIGINT NOT NULL,
    
    CONSTRAINT `FK_MANAGER` FOREIGN KEY (`FK_MANAGER_ID`) REFERENCES `USER` (`ID`),
	CONSTRAINT `FK_TYPE_PROJECT` FOREIGN KEY (`FK_TYPE_PROJECT_ID`) REFERENCES `TYPE_PROJECT` (`ID`)
);

CREATE TABLE `BUG_REPORT` (
	`ID` BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	`TITLE` VARCHAR(30) NOT NULL ,
	`SUMMARY` VARCHAR(1255) NOT NULL,
	`STEPS_TO_REPRODUCE` VARCHAR(1255) NOT NULL,
	`ACTUAL_RESULT` VARCHAR(30) NOT NULL,
	`EXPECTED_RESULT` VARCHAR(30) NOT NULL,
	`FK_REPORTER_ID` BIGINT NOT NULL,
	`FK_ASSIGNED_ID` BIGINT NOT NULL,
	`FK_STATUS_ID` BIGINT NOT NULL,
	`FK_PRIORITY_ID` BIGINT NOT NULL,
	`FK_PROJECT_ID` BIGINT NOT NULL,
	`START_BUG_REPORT` DATETIME  NOT NULL,
    
	CONSTRAINT `FK_USER_REPORT` FOREIGN KEY (`FK_REPORTER_ID`) REFERENCES `USER` (`ID`),
	CONSTRAINT `FK_USER_ASSIGNED` FOREIGN KEY (`FK_ASSIGNED_ID`) REFERENCES `USER` (`ID`),
    CONSTRAINT `FK_STATUS` FOREIGN KEY (`FK_STATUS_ID`) REFERENCES `STATUS` (`ID`),
 	CONSTRAINT `FK_PRIORITY` FOREIGN KEY (`FK_PRIORITY_ID`) REFERENCES `PRIORITY` (`ID`),
 	CONSTRAINT `FK_PROJECT` FOREIGN KEY (`FK_PROJECT_ID`) REFERENCES `PROJECT` (`ID`)
    ON UPDATE cascade ON DELETE cascade
);

INSERT INTO `BUG_TRACKER_DB`.`STATUS` (`ID`, `TYPE`) VALUES (1, 'Open');
INSERT INTO `BUG_TRACKER_DB`.`STATUS` (`ID`, `TYPE`) VALUES (2, 'Close');

INSERT INTO `BUG_TRACKER_DB`.`TYPE_PROJECT` (`ID`, `TYPE`) VALUES (1, 'Software');
INSERT INTO `BUG_TRACKER_DB`.`TYPE_PROJECT` (`ID`, `TYPE`) VALUES (2, 'Service_Desk');
INSERT INTO `BUG_TRACKER_DB`.`TYPE_PROJECT` (`ID`, `TYPE`) VALUES (3, 'Business');


INSERT INTO `BUG_TRACKER_DB`.`USER_PROFILE` (`ID`, `ROLE`) VALUES (1, 'Project_Manager');
INSERT INTO `BUG_TRACKER_DB`.`USER_PROFILE` (`ID`, `ROLE`) VALUES (2, 'Developer');
INSERT INTO `BUG_TRACKER_DB`.`USER_PROFILE` (`ID`, `ROLE`) VALUES (3, 'Tester');

INSERT INTO `BUG_TRACKER_DB`.`PRIORITY` (`ID`, `TYPE`) VALUES (1, 'Blocker');
INSERT INTO `BUG_TRACKER_DB`.`PRIORITY` (`ID`, `TYPE`) VALUES (2, 'Critical');
INSERT INTO `BUG_TRACKER_DB`.`PRIORITY` (`ID`, `TYPE`) VALUES (3, 'Major');
INSERT INTO `BUG_TRACKER_DB`.`PRIORITY` (`ID`, `TYPE`) VALUES (4, 'Minor');

INSERT INTO `BUG_TRACKER_DB`.`USER` (`ID`, `LOGIN`, `PASSWORD`, `FIRST_NAME`, `LAST_NAME`, `EMAIL`, `FK_ROLE_ID`) 
VALUES (1, 'aaaa', '$2a$10$9WtaQgO7JxqNSHiBZWXOJOG7a8e2eFSvZ8rofe8349ylJ/1gHosES', 'aaaa', 'aaaa', 'sdvdsvsd@ssss.ru', '1');

INSERT INTO `BUG_TRACKER_DB`.`USER` (`ID`, `LOGIN`, `PASSWORD`, `FIRST_NAME`, `LAST_NAME`, `EMAIL`, `FK_ROLE_ID`) 
VALUES (2, 'bbbb', '$2a$10$9WtaQgO7JxqNSHiBZWXOJOG7a8e2eFSvZ8rofe8349ylJ/1gHosES', 'bbbb', 'bbbb', 'sdvdsvsd@ssss.ru', '1');

INSERT INTO `BUG_TRACKER_DB`.`USER` (`ID`, `LOGIN`, `PASSWORD`, `FIRST_NAME`, `LAST_NAME`, `EMAIL`, `FK_ROLE_ID`) 
VALUES (3, 'cccc', '$2a$10$9WtaQgO7JxqNSHiBZWXOJOG7a8e2eFSvZ8rofe8349ylJ/1gHosES', 'cccc', 'cccc', 'sdvdsvsd@ssss.ru', '2');

INSERT INTO `BUG_TRACKER_DB`.`USER` (`ID`, `LOGIN`, `PASSWORD`, `FIRST_NAME`, `LAST_NAME`, `EMAIL`, `FK_ROLE_ID`) 
VALUES (4, 'dddd', '$2a$10$9WtaQgO7JxqNSHiBZWXOJOG7a8e2eFSvZ8rofe8349ylJ/1gHosES', 'dddd', 'dddd', 'sdvdsvsd@ssss.ru', '1');

INSERT INTO `BUG_TRACKER_DB`.`USER` (`ID`, `LOGIN`, `PASSWORD`, `FIRST_NAME`, `LAST_NAME`, `EMAIL`, `FK_ROLE_ID`) 
VALUES (5, 'eeee', '$2a$10$9WtaQgO7JxqNSHiBZWXOJOG7a8e2eFSvZ8rofe8349ylJ/1gHosES', 'eeee', 'eeee', 'sdvdsvsd@ssss.ru', '3');

INSERT INTO `BUG_TRACKER_DB`.`PROJECT` (`ID`, `NAME_PROJECT`, `URL`, `FK_MANAGER_ID`, `FK_TYPE_PROJECT_ID`) 
VALUES (1, 'aaaaa', 'Url is not exist', '1', '1');

INSERT INTO `BUG_TRACKER_DB`.`PROJECT` (`ID`, `NAME_PROJECT`, `URL`, `FK_MANAGER_ID`, `FK_TYPE_PROJECT_ID`) 
VALUES (2, 'bbbbb', 'https://translate.yandex.by', '2', '2');

INSERT INTO `BUG_TRACKER_DB`.`PROJECT` (`ID`, `NAME_PROJECT`, `URL`, `FK_MANAGER_ID`, `FK_TYPE_PROJECT_ID`) 
VALUES (3, 'ccccc', 'https://translate.google.com', '4', '3');

INSERT INTO `BUG_TRACKER_DB`.`BUG_REPORT` (`ID`, `TITLE`, `SUMMARY`, `STEPS_TO_REPRODUCE`, `ACTUAL_RESULT`, `EXPECTED_RESULT`, `FK_REPORTER_ID`, `FK_ASSIGNED_ID`,
 `FK_STATUS_ID`, `FK_PRIORITY_ID`, `FK_PROJECT_ID`, `START_BUG_REPORT`) 
VALUES (1, 'aaaaaa', 'summary', 'steps', 'actual', 'expected', '5', '1', '1', '3', '1', '2016-04-15 14:04:03');

INSERT INTO `BUG_TRACKER_DB`.`BUG_REPORT` (`ID`, `TITLE`, `SUMMARY`, `STEPS_TO_REPRODUCE`, `ACTUAL_RESULT`, `EXPECTED_RESULT`, `FK_REPORTER_ID`, `FK_ASSIGNED_ID`,
 `FK_STATUS_ID`, `FK_PRIORITY_ID`, `FK_PROJECT_ID`, `START_BUG_REPORT`) 
VALUES (2, 'bbbbbb', 'summary', 'steps', 'actual', 'expected', '5', '4', '1', '2', '1', '2016-04-16 14:04:03');

INSERT INTO `BUG_TRACKER_DB`.`BUG_REPORT` (`ID`, `TITLE`, `SUMMARY`, `STEPS_TO_REPRODUCE`, `ACTUAL_RESULT`, `EXPECTED_RESULT`, `FK_REPORTER_ID`, `FK_ASSIGNED_ID`,
 `FK_STATUS_ID`, `FK_PRIORITY_ID`, `FK_PROJECT_ID`, `START_BUG_REPORT`) 
VALUES (3, 'cccccc', 'summary', 'steps', 'actual', 'expected', '5', '1', '2', '1', '1', '2016-04-16 16:44:33');

INSERT INTO `BUG_TRACKER_DB`.`BUG_REPORT` (`ID`, `TITLE`, `SUMMARY`, `STEPS_TO_REPRODUCE`, `ACTUAL_RESULT`, `EXPECTED_RESULT`, `FK_REPORTER_ID`, `FK_ASSIGNED_ID`,
 `FK_STATUS_ID`, `FK_PRIORITY_ID`, `FK_PROJECT_ID`, `START_BUG_REPORT`) 
VALUES (4, 'dddddd', 'summary', 'steps', 'actual', 'expected', '5', '1', '1', '1', '2', '2016-04-17 14:04:03');

INSERT INTO `BUG_TRACKER_DB`.`BUG_REPORT` (`ID`, `TITLE`, `SUMMARY`, `STEPS_TO_REPRODUCE`, `ACTUAL_RESULT`, `EXPECTED_RESULT`, `FK_REPORTER_ID`, `FK_ASSIGNED_ID`,
 `FK_STATUS_ID`, `FK_PRIORITY_ID`, `FK_PROJECT_ID`, `START_BUG_REPORT`) 
VALUES (5, 'eeeeee', 'summary', 'steps', 'actual', 'expected', '5', '4', '2', '3', '2', '2016-04-17 15:04:03');

INSERT INTO `BUG_TRACKER_DB`.`BUG_REPORT` (`ID`, `TITLE`, `SUMMARY`, `STEPS_TO_REPRODUCE`, `ACTUAL_RESULT`, `EXPECTED_RESULT`, `FK_REPORTER_ID`, `FK_ASSIGNED_ID`,
 `FK_STATUS_ID`, `FK_PRIORITY_ID`, `FK_PROJECT_ID`, `START_BUG_REPORT`) 
VALUES (6, 'ffffff', 'summary', 'steps', 'actual', 'expected', '5', '4', '1', '4', '2', '2016-04-18 09:02:06');

INSERT INTO `BUG_TRACKER_DB`.`BUG_REPORT` (`ID`, `TITLE`, `SUMMARY`, `STEPS_TO_REPRODUCE`, `ACTUAL_RESULT`, `EXPECTED_RESULT`, `FK_REPORTER_ID`, `FK_ASSIGNED_ID`,
 `FK_STATUS_ID`, `FK_PRIORITY_ID`, `FK_PROJECT_ID`, `START_BUG_REPORT`) 
VALUES (7, 'gggggg', 'summary', 'steps', 'actual', 'expected', '3', '2', '2', '2', '3', '2016-04-18 10:06:03');

INSERT INTO `BUG_TRACKER_DB`.`BUG_REPORT` (`ID`, `TITLE`, `SUMMARY`, `STEPS_TO_REPRODUCE`, `ACTUAL_RESULT`, `EXPECTED_RESULT`, `FK_REPORTER_ID`, `FK_ASSIGNED_ID`,
 `FK_STATUS_ID`, `FK_PRIORITY_ID`, `FK_PROJECT_ID`, `START_BUG_REPORT`) 
VALUES (8, 'hhhhhh', 'summary', 'steps', 'actual', 'expected', '3', '2', '1', '1', '3', '2016-04-18 14:04:03');

INSERT INTO `BUG_TRACKER_DB`.`BUG_REPORT` (`ID`, `TITLE`, `SUMMARY`, `STEPS_TO_REPRODUCE`, `ACTUAL_RESULT`, `EXPECTED_RESULT`, `FK_REPORTER_ID`, `FK_ASSIGNED_ID`,
 `FK_STATUS_ID`, `FK_PRIORITY_ID`, `FK_PROJECT_ID`, `START_BUG_REPORT`) 
VALUES (9, 'iiiiii', 'summary', 'steps', 'actual', 'expected', '3', '2', '1', '4', '3', '2016-04-20 15:15:15');
